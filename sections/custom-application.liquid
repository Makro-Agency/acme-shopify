
{{ 'custom-application.css' | asset_url | stylesheet_tag }}

<div class="custom-wholesale-application">
    <div class="section-heading">
        <h1>WHOLESALE APPLICATION</h1>
        <p>Interested in becoming a wholesale customer? Please fill out the application form below and we will get back to you shortly.</p>
    </div>
    {% if section.settings.formlink != blank %}
    <div class="custom-application-form">
        <form action="{{section.settings.formlink}}" id="wholesale-form">
            <!-- First & Last Name Side-by-Side -->
            <div class="two-column">
                <div class="two-column-inner">
                    <fieldset class="form-fieldset">
                        <legend class="required">First Name</legend>
                        <input type="text" id="first-name" name="first_name" class="form-control" placeholder="First Name" required>
                    </fieldset>
                    <div class="error-message" style="display: none;"> <span class="error-icon"> {% render 'custom-error' %}</span> THIS FIELD IS REQUIRED</div>
                </div>
                <div class="two-column-inner">
                    <fieldset class="form-fieldset">
                        <legend class="required">Last Name</legend>
                        <input type="text" id="last-name" name="last_name" class="form-control" placeholder="Last Name" required>
                    </fieldset>
                    <div class="error-message" style="display: none;"> <span class="error-icon"> {% render 'custom-error' %}</span> THIS FIELD IS REQUIRED</div>
                </div>
            </div>

            <!-- Email -->
            <fieldset class="form-fieldset">
                <legend class="required">Email</legend>
                <input type="email" id="email" name="email" class="form-control" placeholder="Email" required>
            </fieldset>
            <div class="error-message" style="display: none;"> <span class="error-icon"> {% render 'custom-error' %}</span> THIS FIELD IS REQUIRED</div>

            <!-- Name of Business -->
            <fieldset class="form-fieldset">
                <legend class="required">Name of Your Business</legend>
                <input type="text" id="business-name" name="business_name" class="form-control" placeholder="Name of your business" required>
            </fieldset>
            <div class="error-message" style="display: none;"> <span class="error-icon"> {% render 'custom-error' %}</span> THIS FIELD IS REQUIRED</div>
            
            <!-- Tax ID/EIN Number -->
            <fieldset class="form-fieldset">
                <legend class="required">Tax ID/EIN Number</legend>
                <input type="text" id="tax-id" name="tax_id" class="form-control" placeholder="Tax ID/EIN Number" required>
            </fieldset>
            <div class="error-message" style="display: none;"> <span class="error-icon"> {% render 'custom-error' %}</span> THIS FIELD IS REQUIRED</div>
            
            <!-- Shipping Address -->
            <fieldset class="form-fieldset">
                <legend class="required">Your Shipping Address</legend>
                <input type="text" id="address" name="address" class="form-control" placeholder="Your Shipping Address" required>
            </fieldset>
            <div class="error-message" style="display: none;"> <span class="error-icon"> {% render 'custom-error' %}</span> THIS FIELD IS REQUIRED</div>
            
            <!-- ZIP Code -->
            <fieldset class="form-fieldset">
                <legend class="required">ZIP Code</legend>
                <input type="text" id="zip-code" name="zip_code" class="form-control" placeholder="ZIP Code" required>
            </fieldset>
            <div class="error-message" style="display: none;"> <span class="error-icon"> {% render 'custom-error' %}</span> THIS FIELD IS REQUIRED</div>
            
            <fieldset class="form-fieldset dropdown" data-form-dropdwon-wrapper>
                <legend class="required">Country</legend>
                
                {% capture country_data %}
                  {{ all_country_option_tags }}
                {% endcapture %}
                <div class="custom-dropdown">
                    <select class="hide" id="country-drop" required name="country-drop"><option value=""></option>{{ all_country_option_tags }}</select>
                    <div class="selected-option" data-form-dropdwon-active>Please Select</div>
                    <div class="dropdown-arrow">
                        {% render 'custom-dropdown-icon' %}
                    </div>
                    <div class="dropdown-options" data-province-append="#stateProvince-drop" data-tag="#country-drop">
                      {{ country_data | replace:'<option','<div class="option"' | replace:'</option','</div' | replace:'value=','data-value=' }}
                    </div>
                </div>
            </fieldset>
            <div class="error-message" style="display: none;"> <span class="error-icon"> {% render 'custom-error' %}</span> THIS FIELD IS REQUIRED</div>

            <fieldset class="form-fieldset dropdown" data-form-dropdwon-wrapper>
                <legend class="required">State</legend>
                <div class="custom-dropdown">
                    <select class="hide" id="stateProvince-drop" name="stateProvince" required></select>
                    <div class="selected-option" data-form-dropdwon-active>Please Select</div>
                    <!-- SVG arrow rendered from your snippet -->
                    <div class="dropdown-arrow">
                        {% render 'custom-dropdown-icon' %}
                    </div>
                    <div class="dropdown-options" data-tag="#stateProvince-drop">
                        <div class="option" data-value="California">California</div>
                        <div class="option" data-value="Texas">Texas</div>
                        <div class="option" data-value="New York">New York</div>
                        <div class="option" data-value="Florida">Florida</div>
                        <div class="option" data-value="Other">Other</div>
                        <!-- Add more options as needed -->
                    </div>
                </div>
                <input type="hidden" id="state-value" name="state" value="">
            </fieldset>
            <div class="error-message" style="display: none;"> <span class="error-icon"> {% render 'custom-error' %}</span> THIS FIELD IS REQUIRED</div>
            
            <!-- City -->
            <fieldset class="form-fieldset">
                <legend class="required">City</legend>
                <input type="text" id="city" name="city" class="form-control" placeholder="City" required>
            </fieldset>
            <div class="error-message" style="display:none"> <span class="error-icon"> {% render 'custom-error' %}</span> THIS FIELD IS REQUIRED</div>
            
            <!-- Country Code & Phone Number Side-by-Side -->
            <div class="two-column last-fields">
                <div class="two-column-inner country-code">
                    <fieldset class="form-fieldset country-code">
                        <legend class="required">Country Code</legend>
                        <input type="text" id="country-code" name="country_code" class="form-control" placeholder="+" required oninput="limitToTwoDigits(this)">
                    </fieldset>
                    <div class="error-message" style="display: none;"> <span class="error-icon"> {% render 'custom-error' %}</span> THIS FIELD IS REQUIRED</div>
                </div>
                <div class="two-column-inner">
                    <fieldset class="form-fieldset">
                        <legend class="required">Phone Number</legend>
                        <input type="text" id="phone-number" name="phone_number" class="form-control" placeholder="(___) ___-____" required oninput="formatPhoneNumber(this)" maxlength="14">
                    </fieldset>
                    <div class="error-message" style="display: none;"> <span class="error-icon"> {% render 'custom-error' %}</span> THIS FIELD IS REQUIRED</div>
                </div>
            </div>
            <div class="checkbox-group">
                <label class="custom-checkbox-container">
                    <input type="checkbox" name="agree_terms" required>
                    <span class="checkmark"></span>
                    <span class="checkbox-label">
                    I Agree to the <a href="#" class="conditions">Terms and Conditions </a>
                    <span class="required-asterisk">*</span>
                    </span>
                </label>
            </div>
            <button type="submit" class="btn-submit">SUBMIT
              <div class="loading-overlay__spinner hide">
                {% render 'icon-spinner' %}
              </div>
            </button>
            
        </form>
        <div class="custom-wholesale-application success hide">
          <div class="success-container" id="success-container">
              <div class="success-icon">
                  {% render 'success-message' %}
              </div>
              <h1 class="success-title">THANK YOU!</h1>
              <p class="success-message">The form has been successfully submitted</p>
              <a href="#" class="go-back-button" onclick="goBack()">GO BACK</a>
          </div>
      </div>
    </div>
    {% endif %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {

    document.addEventListener("click",function(e){
      console.log('_hearAboutActive');
      var _hearAboutActive = e.target.hasAttribute('data-form-dropdwon-active');
      if( e.target.closest('[data-tag]') != null && e.target.hasAttribute('data-value') ){
        
        let value = e.target.getAttribute("data-value");
        var _hearAboutSelect = document.querySelector(e.target.closest('[data-tag]').getAttribute('data-tag'));
        var _appednActiveText = e.target.closest('[data-form-dropdwon-wrapper]').querySelector('[data-form-dropdwon-active]');      
        if(_hearAboutSelect){
          _hearAboutSelect.value = value;
          _hearAboutSelect.closest('.form-fieldset').nextElementSibling.style.display = 'none';
        } 
        if(_appednActiveText) _appednActiveText.innerText = e.target.innerText;
        
        let provines = e.target.getAttribute("data-provinces") || null;
        var appendEle = e.target.closest('[data-province-append]') != null ? document.querySelector(e.target.closest('[data-province-append]').getAttribute('data-province-append')) : null;
        if( provines != null && provines.length > 2 ){
          console.log( JSON.parse(provines),'provines', provines.length );
          var provinesJSON = JSON.parse(provines);
          var _option = '', _li = '', _ul = document.createElement("ul"), _div = document.createElement("div");
          for(var i = 0; i < provinesJSON.length; i++){          
            _option = _option + `<option value="${provinesJSON[i][0]}">${provinesJSON[i][0]}</option>`;
            _li = _li + `<div class="option" data-value="${provinesJSON[i][0]}">${provinesJSON[i][0]}</div>`;
          }        
          appendEle.innerHTML = _option;
          appendEle.value = '';
          appendEle.closest('[data-form-dropdwon-wrapper]').querySelector('[data-form-dropdwon-active]').innerText = 'Please Select';
          appendEle.closest('[data-form-dropdwon-wrapper]').querySelector('.dropdown-options').innerHTML = _li;
          appendEle.closest('[data-form-dropdwon-wrapper]').classList.remove('hide');
        }else{
          if( appendEle ){
            console.log('appendEle',appendEle);
            appendEle.closest('[data-form-dropdwon-wrapper]').classList.add('hide');
            appendEle.closest('[data-form-dropdwon-wrapper]').nextElementSibling.style.display = 'none';
            appendEle.value = '';
          }
        }
      }
      if(_hearAboutActive){
        var _hearAboutWrap = e.target.closest('[data-form-dropdwon-wrapper]');
        if(_hearAboutWrap.classList.contains("active")){
          _hearAboutWrap.classList.remove("active");
        }else{        
          document.querySelectorAll('[data-form-dropdwon-wrapper].active').forEach(function(ele, eleIndex, eleArray){
            ele.classList.remove('active');
          });
          _hearAboutWrap.classList.add("active");
        }
      }
      if( !_hearAboutActive && document.querySelector('[data-form-dropdwon-wrapper].active') != null ){
        document.querySelectorAll('[data-form-dropdwon-wrapper].active').forEach(function(ele, eleIndex, eleArray){
          ele.classList.remove('active');
        });
      }
    });

    document.querySelector('.custom-wholesale-application .custom-application-form form .btn-submit').addEventListener("click",function(e){
      var _fieldEmpty = false;
      
      var _passwrodMatch = false;
      if( this.closest('form').querySelectorAll('input[type="password"]').length == 0 ){
        _passwrodMatch = true;
      }
  
      this.closest('form').querySelector('input[type="email"]').closest('.form-fieldset').nextElementSibling.style.display = 'none';
      if( this.closest('form').querySelector('input[type="email"]') && !validateEmail(this.closest('form').querySelector('input[type="email"]').value) ){
        this.closest('form').querySelector('input[type="email"]').closest('.form-fieldset').nextElementSibling.style.display = 'block';
        _passwrodMatch = false;
      }
  
      var _requiredFiledCount = this.closest('form').querySelectorAll('*[required]').length, _FiledFilledCount = 0;
      this.closest('form').querySelectorAll('*[required]').forEach(function(ele, eleIndex, eleArray){
        /*if( ele.tagName == "SELECT" ){console.log(ele.tagName, ele.value, ele);}*/
        
        if(ele.closest('[data-form-dropdwon-wrapper]') && ele.closest('[data-form-dropdwon-wrapper]').classList.contains('hide')){
          _FiledFilledCount += 1;
          ele.closest('[data-form-dropdwon-wrapper]').remove();
        }else{
          if( ele.value == '' ){
            ele.closest('.form-fieldset').nextElementSibling.style.display = 'block';
          }else{
            if( ele.closest('.form-fieldset') && ele.closest('.form-fieldset').nextElementSibling.style.display == 'block'){
              ele.closest('.form-fieldset').nextElementSibling.style.display == 'none';
            }
            _FiledFilledCount += 1;
          }
        }
        
  
        if( ele.type == "checkbox" && ele.name == "agree_terms" && ele.checked == false ){        
          _FiledFilledCount -= 1;
        }

        
      });
      console.log(_requiredFiledCount, _FiledFilledCount);
      if( _requiredFiledCount != _FiledFilledCount ){
        _passwrodMatch = false;
      }
      
      console.log('_passwrodMatch',_passwrodMatch, _fieldEmpty);
      if(!_passwrodMatch){
        e.preventDefault();
      }else{
        formSubmit(e);
      }
    });

    // Since you might have multiple custom dropdowns on the page (Country, State, etc.),
    // itâ€™s best to query all of them:
    {% comment %} var dropdowns = document.querySelectorAll('.custom-dropdown');

    dropdowns.forEach(function(dropdown) {
      var selectedOption = dropdown.querySelector('.selected-option');
      var options = dropdown.querySelectorAll('.option');

      // Toggle dropdown open/close when clicking the selected option area
      selectedOption.addEventListener('click', function(e) {
        e.stopPropagation();
        dropdown.classList.toggle('active');
      });

      // Update the selected text and hidden input when an option is clicked
      options.forEach(function(option) {
        option.addEventListener('click', function(e) {
          var value = this.getAttribute('data-value');
          selectedOption.textContent = this.textContent;

          // If a hidden input is linked via a data attribute on the dropdown, update its value
          var hiddenInputId = dropdown.getAttribute('data-input-id');
          if (hiddenInputId) {
            document.getElementById(hiddenInputId).value = value;
          }
          dropdown.classList.remove('active');
        });
      });
    }); {% endcomment %}

    // Close any open dropdown if a click occurs outside
    {% comment %} document.addEventListener('click', function(e) {
      dropdowns.forEach(function(dropdown) {
        if (!dropdown.contains(e.target)) {
          dropdown.classList.remove('active');
        }
      });
    }); {% endcomment %}

    document.querySelectorAll('.custom-application-form form *[required]').forEach(function(ele, eleIndex, eleArray){
      ele.addEventListener("focus", inputFunction);
      ele.addEventListener("blur", inputFunction);    
    });
    
  });

  function formSubmit(e) {
    //clearErrors();
    e.preventDefault();

    document.querySelector('.custom-application-form .btn-submit').classList.add('loading');
    document.querySelector('.custom-application-form .btn-submit .loading-overlay__spinner').classList.remove('hide');
    window.scrollTo({top: 0, behavior: 'smooth'});
    e.target.closest('form').classList.add('hide');
    e.target.closest(".custom-application-form").querySelector(".custom-wholesale-application.success").classList.remove('hide');

    {% comment %} var url = form.getAttribute('action');    
    var config = fetchConfig('javascript');
    delete config.headers['Content-Type'];
    config.headers['Accept'] = '/';
    var formData = new FormData(form);
    config.body = formData;
    fetch(`${url}`, config)
      .then((response) => response.json())
      .then((response) => {
        if (response.status) {
          window.scrollTo({top: 0, behavior: 'smooth'});
          form.classList.add('hide');
          form.closest(".custom-application-form").querySelector(".custom-wholesale-application.success").classList.remove('hide');
        }
      })
      .catch(e => {
        console.error(e);
      }); {% endcomment %}
  };

  function goBack(){
    location.reload();
  }

  function limitToTwoDigits(input) {
      
    input.value = input.value.replace(/\D/g, '');

    if (input.value.length > 2) {
      input.value = input.value.slice(0, 2);
    }
  }

  function formatPhoneNumber(input) {
    // Remove all non-digit characters
    let numbers = input.value.replace(/\D/g, '').slice(0, 10);

    let formatted = '';

    if (numbers.length > 0) {
      formatted = '(' + numbers.slice(0, 3);
    }
    if (numbers.length >= 4) {
      formatted += ') ' + numbers.slice(3, 6);
    }
    if (numbers.length >= 7) {
      formatted += '-' + numbers.slice(6, 10);
    }

    input.value = formatted;
  }

  function inputFunction(event){
    if( event.target.value == '' ){
      var fieldset = event.target.closest('.form-fieldset');
      if (fieldset) {
        var errorDiv = fieldset.nextElementSibling;
        if (errorDiv && errorDiv.classList.contains('error-message')) {
          errorDiv.style.display = 'block';
        }
      }
    }else{
      if( event.target.type == "email" && !validateEmail(event.target.value) ){
        
        var fieldset = event.target.closest('.form-fieldset');
        if (fieldset) {
          var errorDiv = fieldset.nextElementSibling;
          if (errorDiv && errorDiv.classList.contains('error-message')) {
            errorDiv.style.display = 'block';
          }
        }
      }else {
        if( event.target.closest('.form-fieldset') && event.target.closest('.form-fieldset').nextElementSibling.classList.contains('error-message') ){
          event.target.closest('.form-fieldset').nextElementSibling.style.display = 'none';
        }
      }
    }
  }

  function validateEmail(mail) {
    if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail)){
      return (true);
    }    
    return (false);
  }

  // Utility function to clear error styling/message for all fields
  function clearErrors() {
    var errorFieldsets = form.querySelectorAll('.form-fieldset.error');
    errorFieldsets.forEach(function(fs) {
      fs.classList.remove('error');
    });
    var errorMessages = form.querySelectorAll('.error-message');
    errorMessages.forEach(function(msg) {
      msg.style.display = 'none';
    });
  }
</script>

{% schema %}
{
  "name": "Custom Application",
  "settings": [
    {
      "type": "text",
      "id":"formlink",
      "label": "Add form link"
    }
  ],
  "presets": [
    {
      "name": "Custom Application"
    }
  ]
}
{% endschema %}