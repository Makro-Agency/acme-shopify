<div class="page-header">
    <h2 class="title">{{ section.settings.title }}</h2>
    {{ customer.first_name }}<br>
    {% assign all_products_id = '' %}
    {% assign all_products_qty = '' %}
    {% assign all_products_obj = '' %}
    {% for order in customer.orders %}
      {% assign prod_data = order.line_items | sort: "quantity" | reverse %}
      {% for item in prod_data %}
        {% if all_products_obj == '' %}
          {% assign all_products_obj = item.product.id %}
          {% assign all_products_qty = item.quantity %}
        {% else %}
          {% assign all_products_obj = all_products_obj | append:',' | append:item.product.id %}
          {% assign all_products_qty = all_products_qty | append:',' | append:item.quantity %}
        {% endif %}
      {% endfor %}
      <br><br>

      {% if forloop.last %}
      {% endif %}
    {% endfor %}
    {% assign uniq_array = all_products_obj | split:',' | uniq %}
    {% assign uniq_qty = blank %}

    {% assign prod_ids = all_products_obj | split:',' %}
    {% assign prod_qty = all_products_qty | split:',' %}

    
    
    {% for item_id in uniq_array %}
      {% assign quantity_obj = 0 %}
      {% assign set_item_id = item_id %}
      {% for item_id_inner in prod_ids %}
        {% if item_id_inner == set_item_id %}
          {% assign get_qty = prod_qty[forloop.index0] | times:1 %}
          {% assign quantity_obj = quantity_obj | plus:get_qty %}
        {% endif %}
      {% endfor %}
      {% if uniq_qty == blank %}
        {% assign uniq_qty = quantity_obj %}
      {% else %}
        {% assign uniq_qty = uniq_qty | append:',' | append:quantity_obj %}
      {% endif %}
    {% endfor %}

    {% assign split_qty = uniq_qty | split:',' %}
    {% assign uniq_array2 = blank %}
    {% assign ignoreindex = blank %}

    {% for hq in split_qty %}
      {% assign temp_index = forloop.index0 %}
      {% for inner_hq in split_qty %}
        {% if ignoreindex contains forloop.index0 %}
          {% continue %}
        {% endif %}
        {% assign inner_hq_t = inner_hq | times:1 %}
        {% assign hq_t = hq | times:1 %}
        {% if hq_t > inner_hq_t %}
          {% assign temp_index = forloop.index0 %}
        {% elsif inner_hq_t > hq_t %}
          {% assign temp_index = forloop.index0 %}
        {% endif %}
      {% endfor %}
      {% if uniq_array2 != blank %}
        {% assign uniq_array2 = uniq_array[temp_index] %}
        {% assign ignoreindex = temp_index %}
      {% else %}
        {% assign uniq_array2 = uniq_array2 | append:',' | append:uniq_array[temp_index] %}
        {% assign ignoreindex = ignoreindex | append:',' | append:temp_index %}
      {% endif %}
    {% endfor %}


</div>

{% schema %}
{
  "name": "Frequnt Buy",
  "class": "frequnt-buy",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title"
    }
  ],      
  "presets": [
    {
      "name": "Frequnt Buy"
    }
  ]
}
{% endschema %}